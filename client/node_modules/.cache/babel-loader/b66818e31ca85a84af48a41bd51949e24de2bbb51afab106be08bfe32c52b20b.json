{"ast":null,"code":"import { Brush } from '../tools/Brush';\nimport { Eraser } from '../tools/Eraser';\nimport canvasState from '../store/canvasState';\nimport toolState from '../store/toolState';\nimport { Rect } from '../tools/Rect';\nexport const setSocketListener = socket => {\n  socket.onmessage = msg => {\n    const parsedMsg = JSON.parse(msg.data);\n    if (!toolState.tool || !canvasState.ctx) return;\n    switch (parsedMsg.method) {\n      case 'draw':\n        sokcetMessageHandler(parsedMsg);\n        break;\n      case 'finish':\n        canvasState.pushToUndo();\n        canvasState.ctx.beginPath();\n        break;\n      default:\n        break;\n    }\n  };\n};\nexport const connetUserToSession = (socket, id) => {\n  return username => {\n    var _canvasState$socket;\n    canvasState.setWebSocket(socket);\n    canvasState.setId(id);\n    (_canvasState$socket = canvasState.socket) === null || _canvasState$socket === void 0 ? void 0 : _canvasState$socket.send(JSON.stringify({\n      id: id,\n      method: 'connection',\n      username: username\n    }));\n  };\n};\nexport const sokcetMessageHandler = msg => {\n  const figure = msg.figure;\n  const [canvas, ctx, socket, id] = [canvasState.canvas, canvasState.ctx, canvasState.socket, canvasState.id];\n  const savePrevTool = toolState.tool;\n  if (!id || !ctx || !savePrevTool) return;\n  switch (figure.type) {\n    case 'brush':\n      if (!toolState.tool) return;\n      if (toolState.tool instanceof Brush) {\n        toolState.tool.draw(ctx, figure.x, figure.y);\n        toolState.setTool(savePrevTool);\n      } else {\n        toolState.setTool(new Brush(canvas, socket, id));\n        if (!toolState.tool || !(toolState.tool instanceof Brush)) return;\n        toolState.tool.draw(ctx, figure.x, figure.y);\n        toolState.setTool(savePrevTool);\n      }\n      break;\n    case 'eraser':\n      if (toolState.tool instanceof Eraser) {\n        toolState.tool.draw(ctx, figure.x, figure.y);\n        toolState.setTool(savePrevTool);\n      } else {\n        toolState.setTool(new Eraser(canvas, socket, id));\n        if (!toolState.tool || !(toolState.tool instanceof Eraser)) return;\n        toolState.tool.draw(ctx, figure.x, figure.y);\n        toolState.setTool(savePrevTool);\n      }\n      break;\n    case 'rect':\n      if (!figure.w || !figure.h) return;\n      if (toolState.tool instanceof Rect) {\n        var _canvasState$canvas;\n        toolState.tool.savedCanvas = (_canvasState$canvas = canvasState.canvas) === null || _canvasState$canvas === void 0 ? void 0 : _canvasState$canvas.toDataURL();\n        toolState.tool.staticDraw(ctx, figure.x, figure.y, figure.w, figure.h);\n      } else {\n        var _canvasState$canvas2;\n        toolState.setTool(new Rect(canvas, socket, id));\n        if (!toolState.tool || !(toolState.tool instanceof Rect)) return;\n        toolState.tool.savedCanvas = (_canvasState$canvas2 = canvasState.canvas) === null || _canvasState$canvas2 === void 0 ? void 0 : _canvasState$canvas2.toDataURL();\n        toolState.tool.staticDraw(ctx, figure.x, figure.y, figure.w, figure.h);\n        toolState.setTool(savePrevTool);\n      }\n      break;\n    default:\n      break;\n  }\n};","map":{"version":3,"names":["Brush","Eraser","canvasState","toolState","Rect","setSocketListener","socket","onmessage","msg","parsedMsg","JSON","parse","data","tool","ctx","method","sokcetMessageHandler","pushToUndo","beginPath","connetUserToSession","id","username","_canvasState$socket","setWebSocket","setId","send","stringify","figure","canvas","savePrevTool","type","draw","x","y","setTool","w","h","_canvasState$canvas","savedCanvas","toDataURL","staticDraw","_canvasState$canvas2"],"sources":["C:/Users/mistR/OneDrive/Рабочий стол/React/ts/paint-ts/client/src/sokcet/socket.ts"],"sourcesContent":["import {MessageI} from '../model/msgI';\r\nimport { Brush } from '../tools/Brush';\r\nimport { Eraser } from '../tools/Eraser';\r\nimport canvasState from '../store/canvasState';\r\nimport toolState from '../store/toolState';\r\nimport { Rect } from '../tools/Rect';\r\n\r\nexport const setSocketListener = (socket: WebSocket) => {\r\n    socket.onmessage = (msg) => {\r\n        const parsedMsg = JSON.parse(msg.data);\r\n        if(!toolState.tool || !canvasState.ctx) return;\r\n\r\n        switch (parsedMsg.method) {\r\n            case 'draw':\r\n                sokcetMessageHandler(parsedMsg);\r\n                break;\r\n    \r\n            case 'finish':\r\n                canvasState.pushToUndo();\r\n                canvasState.ctx.beginPath();\r\n                break;\r\n        \r\n            default:\r\n                break;\r\n        }\r\n    \r\n    }\r\n} \r\n\r\n\r\nexport const connetUserToSession = (socket: WebSocket, id: string): Function => {\r\n\r\n    return (username: string) => {\r\n        canvasState.setWebSocket(socket);\r\n        canvasState.setId(id);\r\n    \r\n        canvasState.socket?.send(JSON.stringify({\r\n          id: id,\r\n          method: 'connection',\r\n          username: username\r\n      }));\r\n    }\r\n  }\r\n\r\nexport const sokcetMessageHandler = (msg: MessageI) => {\r\n    const figure = msg.figure;\r\n    const [canvas, ctx, socket, id] = [canvasState.canvas, canvasState.ctx, canvasState.socket, canvasState.id];\r\n    const savePrevTool = toolState.tool;\r\n    if(!id || !ctx || !savePrevTool) return;\r\n\r\n    switch (figure.type) {\r\n        case 'brush':\r\n            if(!toolState.tool) return;\r\n            if(toolState.tool instanceof Brush) {\r\n                toolState.tool.draw(ctx, figure.x, figure.y);\r\n                toolState.setTool(savePrevTool);\r\n            } else {\r\n                toolState.setTool(new Brush(canvas, socket, id));\r\n                if(!toolState.tool || !(toolState.tool instanceof Brush) ) return;\r\n                toolState.tool.draw(ctx, figure.x, figure.y);\r\n                toolState.setTool(savePrevTool);\r\n            }\r\n            \r\n            break;\r\n            \r\n        case 'eraser':\r\n            if(toolState.tool instanceof Eraser) {\r\n                toolState.tool.draw(ctx, figure.x, figure.y);\r\n                toolState.setTool(savePrevTool);\r\n            } else {\r\n                toolState.setTool(new Eraser(canvas, socket, id));\r\n                if(!toolState.tool || !(toolState.tool instanceof Eraser) ) return;\r\n                toolState.tool.draw(ctx, figure.x, figure.y);\r\n                toolState.setTool(savePrevTool);\r\n            }\r\n            break;\r\n\r\n        case 'rect':\r\n            if(!figure.w || !figure.h) return;\r\n\r\n            if(toolState.tool instanceof Rect) {\r\n                toolState.tool.savedCanvas = canvasState.canvas?.toDataURL();\r\n                toolState.tool.staticDraw(ctx, figure.x, figure.y, figure.w, figure.h);\r\n            } else {\r\n                toolState.setTool(new Rect(canvas, socket, id));\r\n                if(!toolState.tool || !(toolState.tool instanceof Rect) ) return;\r\n\r\n                toolState.tool.savedCanvas = canvasState.canvas?.toDataURL();\r\n                toolState.tool.staticDraw(ctx, figure.x, figure.y, figure.w, figure.h);\r\n                toolState.setTool(savePrevTool);\r\n            }\r\n            break;\r\n\r\n        default:\r\n            break;\r\n    }\r\n}  \r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}