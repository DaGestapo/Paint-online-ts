{"ast":null,"code":"import { Brush, Eraser, Rect } from '../tools/ToolsRouter';\nimport canvasState from '../store/canvasState';\nimport toolState from '../store/toolState';\nexport const sokcetMessageHandler = msg => {\n  const figure = msg.figure;\n  const [canvas, ctx, socket, id] = [canvasState.canvas, canvasState.ctx, canvasState.socket, canvasState.id];\n  const savePrevTool = toolState.tool;\n  if (!id || !ctx || !savePrevTool || !canvas || !socket) return;\n  switch (figure.type) {\n    case 'brush':\n      if (!toolState.tool) return;\n      if (toolState.tool instanceof Brush) {\n        toolState.tool.draw(ctx, figure.x, figure.y);\n        toolState.setTool(savePrevTool);\n      } else {\n        toolState.setTool(new Brush(canvas, socket, ctx, id));\n        if (!toolState.tool || !(toolState.tool instanceof Brush)) return;\n        toolState.tool.draw(ctx, figure.x, figure.y);\n        toolState.setTool(savePrevTool);\n      }\n      break;\n    case 'eraser':\n      if (toolState.tool instanceof Eraser) {\n        toolState.tool.draw(ctx, figure.x, figure.y);\n        toolState.setTool(savePrevTool);\n      } else {\n        toolState.setTool(new Eraser(canvas, socket, id));\n        if (!toolState.tool || !(toolState.tool instanceof Eraser)) return;\n        toolState.tool.draw(ctx, figure.x, figure.y);\n        toolState.setTool(savePrevTool);\n      }\n      break;\n    case 'rect':\n      if (!figure.w || !figure.h) return;\n      if (toolState.tool instanceof Rect) {\n        var _canvasState$canvas;\n        toolState.tool.savedCanvas = (_canvasState$canvas = canvasState.canvas) === null || _canvasState$canvas === void 0 ? void 0 : _canvasState$canvas.toDataURL();\n        toolState.tool.staticDraw(ctx, figure.x, figure.y, figure.w, figure.h);\n      } else {\n        var _canvasState$canvas2;\n        toolState.setTool(new Rect(canvas, socket, id));\n        if (!toolState.tool || !(toolState.tool instanceof Rect)) return;\n        toolState.tool.savedCanvas = (_canvasState$canvas2 = canvasState.canvas) === null || _canvasState$canvas2 === void 0 ? void 0 : _canvasState$canvas2.toDataURL();\n        toolState.tool.staticDraw(ctx, figure.x, figure.y, figure.w, figure.h);\n        toolState.setTool(savePrevTool);\n      }\n      break;\n    default:\n      break;\n  }\n};","map":{"version":3,"names":["Brush","Eraser","Rect","canvasState","toolState","sokcetMessageHandler","msg","figure","canvas","ctx","socket","id","savePrevTool","tool","type","draw","x","y","setTool","w","h","_canvasState$canvas","savedCanvas","toDataURL","staticDraw","_canvasState$canvas2"],"sources":["C:/Users/mistR/OneDrive/Рабочий стол/React/ts/paint-ts/client/src/sokcet/drawHandler.ts"],"sourcesContent":["import {MessageI} from '../model/msgI';\r\nimport { Brush, Eraser, Rect } from '../tools/ToolsRouter';\r\nimport canvasState from '../store/canvasState';\r\nimport toolState from '../store/toolState';\r\n\r\n\r\nexport const sokcetMessageHandler = (msg: MessageI) => {\r\n    const figure = msg.figure;\r\n    const [canvas, ctx, socket, id] = [canvasState.canvas, canvasState.ctx, canvasState.socket, canvasState.id];\r\n    const savePrevTool = toolState.tool;\r\n    if(!id || !ctx || !savePrevTool || !canvas || !socket) return;\r\n\r\n    switch (figure.type) {\r\n        case 'brush':\r\n            if(!toolState.tool) return;\r\n            if(toolState.tool instanceof Brush) {\r\n                toolState.tool.draw(ctx, figure.x, figure.y);\r\n                toolState.setTool(savePrevTool);\r\n            } else {\r\n                toolState.setTool(new Brush(canvas, socket, ctx, id));\r\n                if(!toolState.tool || !(toolState.tool instanceof Brush) ) return;\r\n                toolState.tool.draw(ctx, figure.x, figure.y);\r\n                toolState.setTool(savePrevTool);\r\n            }\r\n            \r\n            break;\r\n            \r\n        case 'eraser':\r\n            if(toolState.tool instanceof Eraser) {\r\n                toolState.tool.draw(ctx, figure.x, figure.y);\r\n                toolState.setTool(savePrevTool);\r\n            } else {\r\n                toolState.setTool(new Eraser(canvas, socket, id));\r\n                if(!toolState.tool || !(toolState.tool instanceof Eraser) ) return;\r\n                toolState.tool.draw(ctx, figure.x, figure.y);\r\n                toolState.setTool(savePrevTool);\r\n            }\r\n            break;\r\n\r\n        case 'rect':\r\n            if(!figure.w || !figure.h) return;\r\n\r\n            if(toolState.tool instanceof Rect) {\r\n                toolState.tool.savedCanvas = canvasState.canvas?.toDataURL();\r\n                toolState.tool.staticDraw(ctx, figure.x, figure.y, figure.w, figure.h);\r\n            } else {\r\n                toolState.setTool(new Rect(canvas, socket, id));\r\n                if(!toolState.tool || !(toolState.tool instanceof Rect) ) return;\r\n\r\n                toolState.tool.savedCanvas = canvasState.canvas?.toDataURL();\r\n                toolState.tool.staticDraw(ctx, figure.x, figure.y, figure.w, figure.h);\r\n                toolState.setTool(savePrevTool);\r\n            }\r\n            break;\r\n\r\n        default:\r\n            break;\r\n    }\r\n}  \r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}