{"ast":null,"code":"import canvasState from '../store/canvasState';\nimport toolState from '../store/toolState';\nimport { drawHandler } from './drawHandler';\nimport { changeSettingHandler } from './settingHandler';\nimport { localStorageHandler } from './localStorageHandler';\nconst connectionHandler = msg => {\n  console.log(msg.username);\n  const savedCanvas = localStorage.getItem(msg.id) ? localStorage.getItem(msg.id) : null;\n  const ctx = canvasState.ctx ? canvasState.ctx : null;\n  if (savedCanvas && ctx) {\n    const img = document.createElement('img');\n    img.src = savedCanvas;\n    setTimeout(() => {\n      ctx.drawImage(img, 0, 0, 600, 400);\n    }, 0);\n  }\n};\nexport const setSocketListener = socket => {\n  socket.onmessage = msg => {\n    const parsedMsg = JSON.parse(msg.data);\n    if (!toolState.tool || !canvasState.ctx) return;\n    switch (parsedMsg.method) {\n      case 'connection':\n        connectionHandler(parsedMsg);\n        break;\n      case 'draw':\n        drawHandler(parsedMsg);\n        break;\n      case 'setting':\n        changeSettingHandler(parsedMsg);\n        break;\n      case 'localStorage':\n        localStorageHandler(parsedMsg);\n        break;\n      case 'finish':\n        canvasState.pushToUndo();\n        canvasState.ctx.beginPath();\n        break;\n      default:\n        break;\n    }\n  };\n};\nexport const handlerUserConnection = (socket, id) => {\n  return username => {\n    var _canvasState$socket;\n    canvasState.setWebSocket(socket);\n    canvasState.setId(id);\n    (_canvasState$socket = canvasState.socket) === null || _canvasState$socket === void 0 ? void 0 : _canvasState$socket.send(JSON.stringify({\n      id: id,\n      method: 'connection',\n      username: username\n    }));\n  };\n};","map":{"version":3,"names":["canvasState","toolState","drawHandler","changeSettingHandler","localStorageHandler","connectionHandler","msg","console","log","username","savedCanvas","localStorage","getItem","id","ctx","img","document","createElement","src","setTimeout","drawImage","setSocketListener","socket","onmessage","parsedMsg","JSON","parse","data","tool","method","pushToUndo","beginPath","handlerUserConnection","_canvasState$socket","setWebSocket","setId","send","stringify"],"sources":["C:/Users/mistR/OneDrive/Рабочий стол/React/ts/paint-ts/client/src/sokcet/socket.ts"],"sourcesContent":["import canvasState from '../store/canvasState';\r\nimport toolState from '../store/toolState';\r\n\r\nimport { ConnectionI } from '../model/msgI';\r\n\r\n\r\nimport { drawHandler } from './drawHandler';\r\nimport { changeSettingHandler } from './settingHandler';\r\nimport { localStorageHandler } from './localStorageHandler';\r\n\r\nconst connectionHandler = (msg: ConnectionI) => {\r\n    console.log(msg.username);\r\n        const savedCanvas = localStorage.getItem(msg.id)\r\n            ? localStorage.getItem(msg.id)\r\n            : null;\r\n        const ctx = canvasState.ctx\r\n            ? canvasState.ctx\r\n            : null;\r\n\r\n        if(savedCanvas && ctx) {\r\n            const img = document.createElement('img');\r\n            img.src = savedCanvas;\r\n\r\n            setTimeout(() => {\r\n                ctx.drawImage(img, 0, 0, 600, 400);\r\n            }, 0);\r\n        }\r\n}\r\n\r\nexport const setSocketListener = (socket: WebSocket) => {\r\n    socket.onmessage = (msg) => {\r\n        const parsedMsg = JSON.parse(msg.data);\r\n        if(!toolState.tool || !canvasState.ctx) return;\r\n        switch (parsedMsg.method) {\r\n\r\n            case 'connection': \r\n                connectionHandler(parsedMsg);\r\n                break;\r\n\r\n            case 'draw':\r\n                drawHandler(parsedMsg);\r\n                break;\r\n\r\n            case 'setting': \r\n                changeSettingHandler(parsedMsg);\r\n                break;\r\n\r\n            case 'localStorage':\r\n                localStorageHandler(parsedMsg)\r\n                break;\r\n    \r\n            case 'finish':\r\n                canvasState.pushToUndo();\r\n                canvasState.ctx.beginPath();\r\n                break;\r\n        \r\n            default:\r\n                break;\r\n        }\r\n    \r\n    }\r\n} \r\n\r\nexport const handlerUserConnection = (socket: WebSocket, id: string): Function => {\r\n\r\n    return (username: string) => {\r\n        canvasState.setWebSocket(socket);\r\n        canvasState.setId(id);\r\n    \r\n        canvasState.socket?.send(JSON.stringify({\r\n          id: id,\r\n          method: 'connection',\r\n          username: username\r\n      }));\r\n    }\r\n  }\r\n"],"mappings":"AAAA,OAAOA,WAAW,MAAM,sBAAsB;AAC9C,OAAOC,SAAS,MAAM,oBAAoB;AAK1C,SAASC,WAAW,QAAQ,eAAe;AAC3C,SAASC,oBAAoB,QAAQ,kBAAkB;AACvD,SAASC,mBAAmB,QAAQ,uBAAuB;AAE3D,MAAMC,iBAAiB,GAAIC,GAAgB,IAAK;EAC5CC,OAAO,CAACC,GAAG,CAACF,GAAG,CAACG,QAAQ,CAAC;EACrB,MAAMC,WAAW,GAAGC,YAAY,CAACC,OAAO,CAACN,GAAG,CAACO,EAAE,CAAC,GAC1CF,YAAY,CAACC,OAAO,CAACN,GAAG,CAACO,EAAE,CAAC,GAC5B,IAAI;EACV,MAAMC,GAAG,GAAGd,WAAW,CAACc,GAAG,GACrBd,WAAW,CAACc,GAAG,GACf,IAAI;EAEV,IAAGJ,WAAW,IAAII,GAAG,EAAE;IACnB,MAAMC,GAAG,GAAGC,QAAQ,CAACC,aAAa,CAAC,KAAK,CAAC;IACzCF,GAAG,CAACG,GAAG,GAAGR,WAAW;IAErBS,UAAU,CAAC,MAAM;MACbL,GAAG,CAACM,SAAS,CAACL,GAAG,EAAE,CAAC,EAAE,CAAC,EAAE,GAAG,EAAE,GAAG,CAAC;IACtC,CAAC,EAAE,CAAC,CAAC;EACT;AACR,CAAC;AAED,OAAO,MAAMM,iBAAiB,GAAIC,MAAiB,IAAK;EACpDA,MAAM,CAACC,SAAS,GAAIjB,GAAG,IAAK;IACxB,MAAMkB,SAAS,GAAGC,IAAI,CAACC,KAAK,CAACpB,GAAG,CAACqB,IAAI,CAAC;IACtC,IAAG,CAAC1B,SAAS,CAAC2B,IAAI,IAAI,CAAC5B,WAAW,CAACc,GAAG,EAAE;IACxC,QAAQU,SAAS,CAACK,MAAM;MAEpB,KAAK,YAAY;QACbxB,iBAAiB,CAACmB,SAAS,CAAC;QAC5B;MAEJ,KAAK,MAAM;QACPtB,WAAW,CAACsB,SAAS,CAAC;QACtB;MAEJ,KAAK,SAAS;QACVrB,oBAAoB,CAACqB,SAAS,CAAC;QAC/B;MAEJ,KAAK,cAAc;QACfpB,mBAAmB,CAACoB,SAAS,CAAC;QAC9B;MAEJ,KAAK,QAAQ;QACTxB,WAAW,CAAC8B,UAAU,CAAC,CAAC;QACxB9B,WAAW,CAACc,GAAG,CAACiB,SAAS,CAAC,CAAC;QAC3B;MAEJ;QACI;IACR;EAEJ,CAAC;AACL,CAAC;AAED,OAAO,MAAMC,qBAAqB,GAAGA,CAACV,MAAiB,EAAET,EAAU,KAAe;EAE9E,OAAQJ,QAAgB,IAAK;IAAA,IAAAwB,mBAAA;IACzBjC,WAAW,CAACkC,YAAY,CAACZ,MAAM,CAAC;IAChCtB,WAAW,CAACmC,KAAK,CAACtB,EAAE,CAAC;IAErB,CAAAoB,mBAAA,GAAAjC,WAAW,CAACsB,MAAM,cAAAW,mBAAA,uBAAlBA,mBAAA,CAAoBG,IAAI,CAACX,IAAI,CAACY,SAAS,CAAC;MACtCxB,EAAE,EAAEA,EAAE;MACNgB,MAAM,EAAE,YAAY;MACpBpB,QAAQ,EAAEA;IACd,CAAC,CAAC,CAAC;EACL,CAAC;AACH,CAAC"},"metadata":{},"sourceType":"module","externalDependencies":[]}